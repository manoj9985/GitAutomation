package stepDefinition;

import java.time.Duration;

import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import io.cucumber.java.en.And;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;

public class stepDefinitionScenarios {

    static WebDriver driver;
    static WebDriverWait wait;

    @Given("I landed on Ecommerce Page")
    public void i_landed_on_ecommerce_page() throws InterruptedException {
        driver = new ChromeDriver();
        wait = new WebDriverWait(driver, Duration.ofSeconds(15));
        driver.manage().window().maximize();
        driver.get("https://rahulshettyacademy.com/locatorspractice/");
        System.out.println(driver.getTitle());
    }

    @Given("^Logged in with Username and Password$")
    public void Logged_in_with_Username_and_Password() {
        driver.findElement(By.id("inputUsername")).sendKeys("Manoj");
        driver.findElement(By.name("inputPassword")).sendKeys("rahulshettyacademy.");
        driver.findElement(By.className("signInBtn")).click();
        System.out.println(driver.getTitle());
    }

    @When("^I added product to the cart$")
    public void When_I_added_product_to_the_cart() throws InterruptedException {
        driver.get("https://www.google.com/");
        WebElement searchBox = wait.until(ExpectedConditions.visibilityOfElementLocated(By.name("q")));
        searchBox.sendKeys("rahul shetty login page");
        searchBox.sendKeys(Keys.ENTER);

        WebElement link = wait.until(ExpectedConditions.elementToBeClickable(By.xpath("//h3[contains(text(),\"Let's Shop\")]")));
        link.click();

        // Login on actual shop page
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("userEmail"))).sendKeys("dihamoj266@gotemv.com");
        driver.findElement(By.id("userPassword")).sendKeys("M@noj998504");
        driver.findElement(By.id("login")).click();

        // Wait for products to load
        WebElement addToCartBtn = wait.until(ExpectedConditions.elementToBeClickable(
                By.xpath("(//button[@class='btn w-10 rounded'][normalize-space()='Add To Cart'])[1]")));
        addToCartBtn.click();

        WebElement cartButton = wait.until(ExpectedConditions.visibilityOfElementLocated(
                By.cssSelector(".btn.btn-custom[routerlink='/dashboard/cart']")));

        ((JavascriptExecutor) driver).executeScript("arguments[0].scrollIntoView(true);", cartButton);
        wait.until(ExpectedConditions.elementToBeClickable(cartButton)).click();
    }

    @And("^Checkout and submit the order$")
    public void And_Checkout_and_submit_the_order() throws InterruptedException {
        wait.until(ExpectedConditions.visibilityOfElementLocated(By.cssSelector("div[class='cartSection'] h3")));

        WebElement checkoutBtn = wait.until(ExpectedConditions.elementToBeClickable(
                By.xpath("//button[contains(text(),'Checkout')]")));
        ((JavascriptExecutor) driver).executeScript("arguments[0].scrollIntoView(true);", checkoutBtn);
        checkoutBtn.click();

        WebElement countryInput = wait.until(ExpectedConditions.visibilityOfElementLocated(
                By.xpath("//input[contains(@placeholder, 'Select Country')]")));
        countryInput.sendKeys("India");

        try {
            wait.until(ExpectedConditions.elementToBeClickable(By.xpath("(//button[@type='button'])[2]"))).click();
        } catch (Exception e) {
            System.out.println("Country selection failed: " + e.getMessage());
        } finally {
            wait.until(ExpectedConditions.elementToBeClickable(
                By.xpath("//a[contains(@class,'btnn action__submit ng-star-inserted')]"))).click();
        }
    }

    @Then("^message id displayed in confirmation page$")
    public void message_id_displayed_in_confirmation_page() {
        boolean isDisplayed = wait.until(
            ExpectedConditions.visibilityOfElementLocated(By.cssSelector(".hero-primary"))).isDisplayed();
        System.out.println("Confirmation message displayed: " + isDisplayed);
    }
} 